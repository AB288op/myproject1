<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Recipe Classifier — Lightweight UI</title>
<style>
  :root{
    --bg-img: url('asian-food-background-various-cooking-ingredients-rustic-background-top-view-banner-concept-chinese-thai-66582124.jpg'); /* local image path */
    --overlay: rgba(6,8,12,0.55);
    --card-bg: rgba(255,255,255,0.03);
    --muted: #bfcfd9;
    --text: #eef7fb;
    --accent-start: #ff7a7a;
    --accent-end: #06b6d4;
  }

  /* Minimal, performant reset */
  *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
  html,body{height:100%;margin:0}
  body{
    display:flex;align-items:center;justify-content:center;padding:28px;
    background-image: linear-gradient(var(--overlay), var(--overlay)), var(--bg-img);
    background-size:cover;background-position:center;color:var(--text);
  }

  /* Container */
  .container{width:100%;max-width:1000px;display:grid;grid-template-columns:1fr 360px;gap:20px}
  header{grid-column:1/-1;display:flex;align-items:center;gap:12px;margin-bottom:6px}
  .brand{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));display:flex;align-items:center;justify-content:center;font-weight:800;color:#041018}
  h1{margin:0;font-size:18px}
  p.lead{margin:0;color:var(--muted);font-size:13px}

  /* Cards */
  .card{background:var(--card-bg);padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.05)}

  /* Controls */
  .controls{display:flex;gap:10px;margin-bottom:12px}
  input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}
  button{padding:10px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent-start),var(--accent-end));color:#021;font-weight:700;cursor:pointer}
  button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

  textarea{width:100%;min-height:120px;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:inherit}

  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px 10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.04)}
  th{color:var(--muted);font-weight:700;font-size:13px}
  td{font-size:14px}

  /* Keep animations tiny and cheap */
  .fade-in{animation:fadeIn .4s ease-out;opacity:0;animation-fill-mode:forwards}
  @keyframes fadeIn{to{opacity:1}}

  /* Responsive */
  @media(max-width:960px){.container{grid-template-columns:1fr}.brand{width:48px;height:48px}}
  /* Subtle Modern Animations */
  button{
    transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
  }
  button:hover{
    transform: scale(1.03);
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  }
  button:active{
    transform: scale(0.97);
  }
  .card{
    transition: transform .2s ease, box-shadow .2s ease;
  }
  .card:hover{
    transform: translateY(-3px);
    box-shadow: 0 14px 32px rgba(0,0,0,0.35);
  }
  table tr{
    transition: background .15s ease, transform .15s ease;
  }
  table tr:hover{
    background: rgba(255,255,255,0.05);
    transform: translateX(4px);
  }
  #predictResult{
    animation: fadeUp .25s ease forwards;
  }
  @keyframes fadeUp{
    from{opacity:0; transform: translateY(6px);} to{opacity:1; transform:none;}
  }
</style>
</head>
<body>
  <div class="container fade-in">
    <header>
      <div class="brand"></div>
      <div>
        <h1>Recipe Classifier — Lightweight</h1>
        <p class="lead"></p>
      </div>
    </header>

    <section class="card">
      <div class="controls">
        <input id="dishInput" type="text" placeholder="Enter dish name" />
        <button id="lookupBtn">Lookup</button>
        <button id="clearBtn" class="secondary">Clear</button>
      </div>

      <div style="display:flex;gap:12px;align-items:flex-start">
        <div style="flex:1">
          <div style="color:var(--muted);font-size:13px;margin-bottom:6px">Ingredients (editable)</div>
          <textarea id="ingredientsArea" placeholder="Ingredients will appear here when you select a row — edit before predicting."></textarea>
        </div>
        <div style="width:140px;display:flex;flex-direction:column;gap:8px">
          <button id="predictBtn">Predict</button>
          <button id="copyIngr" class="secondary">Copy</button>
          <div id="predictResult" style="display:none;margin-top:6px;color:var(--muted)"><strong id="predCuisine">—</strong><div id="predConf" style="font-size:12px"></div></div>
        </div>
      </div>

      <div style="margin-top:12px">
        <strong>Matches</strong>
        <table id="matchesTable"><thead><tr><th>#</th><th>Name</th><th>Cuisine</th><th>Ingredients</th></tr></thead><tbody></tbody></table>
      </div>

      <div style="margin-top:12px">
        <strong>Suggestions</strong>
        <table id="suggestTable"><thead><tr><th>#</th><th>Name</th><th>Score</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700"></div>
          <div id="serverStatus" style="color:var(--muted)"></div>
        </div>
        <div style="text-align:right">
          <div style="font-size:12px;color:var(--muted)"></div>
          <div id="modelState" style="font-weight:700"></div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div style="font-weight:700"></div>
        <div id="selectedName" style="margin-top:6px;font-weight:700"></div>
        <div id="selectedCuisine" style="color:var(--muted);margin-top:6px"></div>
      </div>

      <div style="margin-top:12px">
        <div style="font-weight:700"></div>
        <pre id="rawRow" style="background:rgba(0, 0, 0, 0);padding:8px;border-radius:8px;color:var(--muted);max-height:180px;overflow:auto">—</pre>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px">
        <button id="healthBtn" class="secondary"></button>
        <button id="reloadBtn" class="secondary"></button>
      </div>

      <div style="margin-top:12px;color:var(--muted);font-size:13px"><code></code></div>
    </aside>
  </div>

<script>
const API_BASE = 'http://127.0.0.1:5000';
function logLast(obj){ try{ document.getElementById('rawRow').textContent = JSON.stringify(obj, null, 2); }catch(e){} }
async function postJSON(path, payload){ const url = (API_BASE || '') + path; const res = await fetch(url, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}); if(!res.ok){ const text = await res.text().catch(()=>'<no body>'); throw new Error(`HTTP ${res.status} ${res.statusText} - ${text}`); } const data = await res.json(); logLast({url,path,payload,response:data}); return data; }

// UI elems
const dishInput = document.getElementById('dishInput');
const lookupBtn = document.getElementById('lookupBtn');
const clearBtn = document.getElementById('clearBtn');
const matchesTableBody = document.querySelector('#matchesTable tbody');
const suggestTableBody = document.querySelector('#suggestTable tbody');
const ingredientsArea = document.getElementById('ingredientsArea');
const predictBtn = document.getElementById('predictBtn');
const predictResultBox = document.getElementById('predictResult');
const predCuisine = document.getElementById('predCuisine');
const predConf = document.getElementById('predConf');
const copyIngr = document.getElementById('copyIngr');
const serverStatus = document.getElementById('serverStatus');
const modelState = document.getElementById('modelState');
const selectedName = document.getElementById('selectedName');
const selectedCuisine = document.getElementById('selectedCuisine');
const rawRow = document.getElementById('rawRow');
const healthBtn = document.getElementById('healthBtn');
const reloadBtn = document.getElementById('reloadBtn');

let lastLookup = null; let selectedRow = null;

async function checkHealth(){ try{ const res = await fetch((API_BASE || '') + '/health'); if(!res.ok) throw new Error(res.status); const body = await res.json(); serverStatus.textContent = `OK — rows: ${body.dataset_rows||0}`; modelState.textContent = body.model_loaded ? (body.pipeline_loaded? 'pipeline' : 'model') : 'loaded'; }catch(e){ serverStatus.textContent = 'Unavailable'; modelState.textContent = '—'; logLast({health_error:String(e)}); } }
checkHealth(); healthBtn.addEventListener('click', checkHealth); reloadBtn.addEventListener('click', ()=>location.reload());

function buildMatchesTable(rows){ matchesTableBody.innerHTML=''; if(!rows || rows.length===0){ const tr=document.createElement('tr'); tr.innerHTML='<td colspan="4" style="color:var(--muted)">No matches</td>'; matchesTableBody.appendChild(tr); return; } rows.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${i+1}</td><td>${r.name||'—'}</td><td>${r.cuisine||'—'}</td><td style="color:var(--muted)">${(r.ingredients||'').slice(0,120)}</td>`; tr.addEventListener('click', ()=>selectRow(r)); matchesTableBody.appendChild(tr); }); }
function buildSuggestTable(rows){ suggestTableBody.innerHTML=''; if(!rows || rows.length===0){ const tr=document.createElement('tr'); tr.innerHTML='<td colspan="3" style="color:var(--muted)">No suggestions</td>'; suggestTableBody.appendChild(tr); return; } rows.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td>${i+1}</td><td>${r.name||'—'}</td><td>${r.score||0}</td>`; tr.addEventListener('click', ()=>selectRow(r)); suggestTableBody.appendChild(tr); }); }

function selectRow(r){ selectedRow = r; selectedName.textContent = r.name || '—'; selectedCuisine.textContent = r.cuisine ? `Cuisine: ${r.cuisine}` : 'Cuisine: —'; ingredientsArea.value = r.ingredients || ''; rawRow.textContent = r.raw_row ? JSON.stringify(r.raw_row, null, 2) : JSON.stringify(r, null, 2); predictResultBox.style.display = 'none'; }

lookupBtn.addEventListener('click', async ()=>{ const name = dishInput.value.trim(); if(!name){ alert('Enter a dish name'); return; } lookupBtn.disabled=true; lookupBtn.textContent='Searching...'; try{ const res = await postJSON('/lookup', {dish_name: name}); lastLookup = res; const matches = []; if(res.exact){ const e=Object.assign({},res.exact); e.raw_row=res.raw_row||null; matches.push(e);} if(res.substring_matches) res.substring_matches.forEach(s=>{ s.raw_row=s.raw_row||null; matches.push(s); }); buildMatchesTable(matches); buildSuggestTable(res.suggestions||[]); if(matches.length) selectRow(matches[0]); else if(res.suggestions && res.suggestions.length) selectRow(res.suggestions[0]); else { selectedName.textContent='—'; selectedCuisine.textContent='—'; ingredientsArea.value=''; rawRow.textContent = JSON.stringify(res.debug||res, null, 2); } }catch(e){ alert('Lookup failed: '+e); } finally{ lookupBtn.disabled=false; lookupBtn.textContent='Lookup'; } });

clearBtn.addEventListener('click', ()=>{ dishInput.value=''; ingredientsArea.value=''; selectedName.textContent='—'; selectedCuisine.textContent='—'; rawRow.textContent='—'; buildMatchesTable([]); buildSuggestTable([]); predictResultBox.style.display='none'; });

copyIngr.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(ingredientsArea.value); alert('Copied'); }catch(e){ alert('Copy failed'); } });

predictBtn.addEventListener('click', async ()=>{ const txt = ingredientsArea.value.trim(); if(!txt){ alert('Enter ingredients'); return; } predictBtn.disabled=true; predictBtn.textContent='Predicting...'; try{ const res = await postJSON('/predict', {ingredients: txt}); document.getElementById('predCuisine').textContent = res.prediction || '—'; document.getElementById('predConf').textContent = res.confidence ? `Confidence: ${Math.round(res.confidence*100)}%` : ''; predictResultBox.style.display = 'block'; if(!selectedRow || !selectedRow.cuisine){ selectedCuisine.textContent = res.prediction ? `Predicted: ${res.prediction}` : selectedCuisine.textContent; } }catch(e){ alert('Predict failed: '+e); } finally{ predictBtn.disabled=false; predictBtn.textContent='Predict'; } });

dishInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); lookupBtn.click(); } });

</script>
</body>
</html>
